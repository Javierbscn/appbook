(()=>{"use strict";var e={257:(e,t,n)=>{n.r(t),n.d(t,{cancel:()=>y,format:()=>m,register:()=>s,render:()=>w});var r=["second","minute","hour","day","week","month","year"],o=["秒","分钟","小时","天","周","个月","年"],a={},s=function(e,t){a[e]=t},c=function(e){return a[e]||a.en_US},d=[60,60,24,7,365/7/12,12];function i(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function l(e,t){for(var n=e<0?1:0,r=e=Math.abs(e),o=0;e>=d[o]&&o<d.length;o++)e/=d[o];return(e=Math.floor(e))>(0==(o*=2)?9:1)&&(o+=1),t(e,o,r)[n].replace("%s",e.toString())}function u(e,t){return(+(t?i(t):new Date)-+i(e))/1e3}var m=function(e,t,n){return l(u(e,n&&n.relativeDate),c(t))},h="timeago-id";function f(e){return parseInt(e.getAttribute(h))}var g={},p=function(e){clearTimeout(e),delete g[e]};function v(e,t,n,r){p(f(e));var o=r.relativeDate,a=r.minInterval,s=u(t,o);e.innerText=l(s,n);var c=setTimeout((function(){v(e,t,n,r)}),Math.min(1e3*Math.max(function(e){for(var t=1,n=0,r=Math.abs(e);e>=d[n]&&n<d.length;n++)e/=d[n],t*=d[n];return r=(r%=t)?t-r:t,Math.ceil(r)}(s),a||1),2147483647));g[c]=0,function(e,t){e.setAttribute(h,t)}(e,c)}function y(e){e?p(f(e)):Object.keys(g).forEach(p)}function w(e,t,n){var r=e.length?e:[e];return r.forEach((function(e){v(e,function(e){return e.getAttribute("datetime")}(e),c(t),n||{})})),r}s("en_US",(function(e,t){if(0===t)return["just now","right now"];var n=r[Math.floor(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]})),s("zh_CN",(function(e,t){if(0===t)return["刚刚","片刻后"];var n=o[~~(t/2)];return[e+" "+n+"前",e+" "+n+"后"]}))}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=new class{constructor(){this.Url="/api/books"}async getBooks(){const e=await fetch(this.Url);return await e.json()}async postBook(e){return(await fetch(this.Url,{method:"POST",body:e})).json()}async deleteBook(e){return(await fetch(`${this.Url}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).json()}},{format:t}=n(257),r=new class{async renderBooks(){this.showLoader();const n=await e.getBooks(),r=document.getElementById("book-cards"),o=document.createElement("div");r.innerHTML=null,n.forEach((e=>{o.innerHTML+=`<div class="card p-3 my-3">\n                <div class="row">\n                    <div class="col-md-4">\n                        <img src="${e.image_path}" class="img-fluid" alt="${e.title}">\n                    </div>\n                    <div class="col-md-8">\n                        <div class="card-block">\n                            <h3 class="card-title">${e.title}</h3>\n                            <p class="card-text">Autor: ${e.author}</p>\n                            <p class="card-text">ISBN: ${e.isbn}</p>\n                            <a href="#" class="btn btn-danger delete" _id="${e._id}">Eliminar</a>\n                        </div>\n                        <div class="card-footer mt-3">\n                            <p class="text-muted">${t(e.created_at)}</p>\n                        </div>\n                    </div>\n                </div>\n            </div>`})),r.appendChild(o),this.showLoader()}async addNewBook(t){this.showLoader();const n=await e.postBook(t);return this.renderBooks(),this.showLoader(),this.clearBookForm(),n}async deleteBook(t){this.showLoader();const n=await e.deleteBook(t);return this.renderBooks(),this.showLoader(),n}clearBookForm(){document.getElementById("book-form").reset()}renderMessage(e,t){const n=document.querySelector(".col-md-4"),r=document.querySelector(".card"),o=document.createElement("div");o.className=`alert alert-${t} message`,o.appendChild(document.createTextNode(e)),n.insertBefore(o,r),setTimeout((()=>{document.querySelector(".message").remove()}),3e3)}showLoader(){document.querySelector(".loader").classList.toggle("d-none")}};document.addEventListener("DOMContentLoaded",(()=>{r.renderBooks()})),document.getElementById("image").addEventListener("change",(e=>{let t=e.target.value.split("\\").pop();document.querySelector(".custom-file-label").innerHTML=t})),document.addEventListener("submit",(async e=>{if(e.target.matches("#book-form")){e.preventDefault();const t=document.getElementById("name").value,n=document.getElementById("author").value,o=document.getElementById("isbn").value,a=document.getElementById("image").files;if(t.length<1||n.length<4||o.length<1||0===a.length)return void r.renderMessage("Datos inválidos, por favor rellena correctamente los campos","danger");const s=new FormData;s.append("title",t),s.append("author",n),s.append("isbn",o),s.append("image",a[0]);const c=await r.addNewBook(s);r.renderMessage(c.message,"success")}})),document.addEventListener("click",(async e=>{if(e.target.matches(".delete")){e.preventDefault();const t=await r.deleteBook(e.target.getAttribute("_id"));r.renderMessage(t.message,"danger")}}))})()})();